# doc-scraper Configuration
# 3 working examples demonstrating all configuration variations

# --- Global Settings ---
default_delay_per_host: 500ms
num_workers: 6
num_image_workers: 4
max_requests: 48
max_requests_per_host: 4
output_base_dir: "./crawled_docs"
state_dir: "./crawler_state"

# Retry settings
max_retries: 3
initial_retry_delay: 1s
max_retry_delay: 30s

# Timeout settings
semaphore_acquire_timeout: 30s
global_crawl_timeout: 0s        # 0 = no timeout
per_page_timeout: 60s           # Per-page timeout

# Size limits
max_page_size_bytes: 52428800   # 50 MiB (max HTML page body size, 0 = 50 MiB default)
max_image_size_bytes: 10485760  # 10 MiB

# Global image defaults
skip_images: false

# Global output settings
enable_output_mapping: true
output_mapping_filename: "url_to_file_map.tsv"
enable_metadata_yaml: true
metadata_yaml_filename: "crawl_meta.yaml"

# HTTP client settings
http_client_settings:
  timeout: 45s
  max_idle_conns: 100
  max_idle_conns_per_host: 6
  idle_conn_timeout: 90s
  tls_handshake_timeout: 10s
  dialer_timeout: 15s
  dialer_keep_alive: 30s

# --- Site Configurations ---
sites:

  # ============================================================================
  # EXAMPLE 1: flask_docs
  # - Auto content detection (Sphinx framework auto-detected)
  # - Images enabled with domain filtering
  # - Full metadata output
  # - Polite rate limiting
  # ============================================================================
  flask_docs:
    start_urls:
      - "https://flask.palletsprojects.com/en/stable/"
    allowed_domain: "flask.palletsprojects.com"
    allowed_path_prefix: "/en/stable/"

    # AUTO: Detects Sphinx framework automatically
    content_selector: "auto"

    max_depth: 2                    # Limit depth
    delay_per_host: 500ms           # Polite crawling
    respect_nofollow: true

    # Image handling
    skip_images: false
    max_image_size_bytes: 5242880   # 5 MiB limit
    allowed_image_domains:
      - "flask.palletsprojects.com"
      - "*.palletsprojects.com"

    # Exclude API reference (too large)
    disallowed_path_patterns:
      - "/en/stable/api/.*"
      - "/en/stable/changes/.*"

    # Output: all features enabled
    enable_output_mapping: true
    output_mapping_filename: "flask_manifest.tsv"
    enable_metadata_yaml: true
    metadata_yaml_filename: "flask_metadata.yaml"

  # ============================================================================
  # EXAMPLE 2: click_docs
  # - Explicit CSS selector for Pallets/Flask-style docs
  # - No images (text-only for LLM training)
  # - Minimal output (no metadata yaml)
  # - Limited depth, fast crawling
  # ============================================================================
  click_docs:
    start_urls:
      - "https://click.palletsprojects.com/en/stable/"
    allowed_domain: "click.palletsprojects.com"
    allowed_path_prefix: "/en/stable/"

    # EXPLICIT: Pallets docs use this structure
    content_selector: "div.body, article"

    max_depth: 2                    # Limited depth
    delay_per_host: 300ms           # Faster crawling
    respect_nofollow: false         # Follow all links

    # No images - text only for LLM ingestion
    skip_images: true

    # Minimal output - just the TSV mapping
    enable_output_mapping: true
    output_mapping_filename: "click_urls.tsv"
    enable_metadata_yaml: false     # Disabled for this site

  # ============================================================================
  # EXAMPLE 3: rust_cli_book
  # - Explicit selector for mdBook framework
  # - Custom link extraction selectors
  # - Full output with custom filenames
  # - Moderate settings
  # ============================================================================
  rust_cli_book:
    start_urls:
      - "https://rust-cli.github.io/book/index.html"
    allowed_domain: "rust-cli.github.io"
    allowed_path_prefix: "/book/"

    # EXPLICIT: mdBook content selector
    content_selector: "#content, main"

    # mdBook navigation structure
    link_extraction_selectors:
      - "nav#sidebar"
      - "nav.nav-wrapper"
      - "main#content"

    max_depth: 0                    # Unlimited
    delay_per_host: 500ms           # Default delay
    respect_nofollow: true

    # Images enabled, use global settings
    skip_images: false

    # Exclude print page and non-content
    disallowed_path_patterns:
      - "/book/print\\.html$"
      - "/book/.*\\?.*"

    # Full output
    enable_output_mapping: true
    output_mapping_filename: "rust_cli_manifest.tsv"
    enable_metadata_yaml: true
    metadata_yaml_filename: "rust_cli_metadata.yaml"
